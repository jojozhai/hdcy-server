<!DOCTYPE HTML>
<html>
<head>

    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>资讯详情</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link href="../themes/default/_css/umeditor.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../third-party/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="editor_api.js"></script>
    <script type="text/javascript" src="../lang/zh-cn/zh-cn.js"></script>
    <style type="text/css">
       .con {
       		width:700px;
       		margin:0 auto;
       		position: relative;

       }
       .submits {
         	position: absolute;
        	right:10px;
       		top:35px;
	    	color: #e95400;
			font-size: 13px;
			background-color: transparent;
			border: 1px solid #e95400;
			border-radius: 10px;
			z-index:33333;
	}

    </style>
</head>
<body>


<!--style给定宽度可以影响编辑器的最终宽度-->

<div class="con">
<script type="text/plain" id="myEditor" style="width:700px;height:240px;">

</script>
<input class="submits" type="button" name="button" value="保存" />

</div>

<script type="text/javascript">
    //实例化编辑器
    var um = UM.getEditor('myEditor');
    function getAllHtml() {
       return UM.getEditor('myEditor').getAllHtml()
    }

  //获取传递过来的id值，和类别的id
    function GetRequest() {
         var url = location.search;
         var theRequest = new Object();
         if (url.indexOf("?") != -1) {
             var str = url.substr(1);
             strs = str.split("&");
             for(var i = 0; i < strs.length; i ++) {
                 theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
             }
         }
         return theRequest;
     }
     var Request = new Object();
     Request = GetRequest();
     var id=Request.id;
     var jsonObj;
  // 发起网路请求  创建请求对象
  var request = new XMLHttpRequest();
  request.onreadystatechange = function () {
 		 if (request.readyState == 4 && request.status == 200) {
   		var jsonStr = request.responseText;
   		// 将json转为对象
  		jsonObj = JSON.parse(jsonStr);
  		um.setContent(jsonObj.content,true);

 		 }
    };
    // 使用请求对象，创建请求
    request.open("get", "/admin2/article/"+id);
    // 发送请求
    request.send();
    $(".submits").on("click",function(){
  	  jsonObj.content=getAllHtml();
  	  var jsonObjs=JSON.stringify(jsonObj);
  	  $.ajax({
	            type: "put",
	            url: "/admin2/article/"+id,
	            data:jsonObjs,
	            dataType: "json",
	            contentType: "application/json; charset=utf-8",
	            success: function (obj) {
	            	alert("保存成功")
	            }
	        });       	  

    })

</script>

</body>
</html>
